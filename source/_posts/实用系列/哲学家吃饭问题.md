---
title: 哲学家吃饭问题
date: 2024-12-18 17:00:00
categories: 实用系列
permalink: dining-philosophers-problem.html
---

有三个哲学家坐在一张桌子上准备吃饭，而且他们定的规矩还比较奇怪：

1. 桌子上一共只有三根筷子，筷子的数量是有限的，且在同一个时间只能由一个人拿起来一根筷子。（互斥条件）
2. 当一个人拿起一根筷子之后，除非他吃完饭了，否则他是不会主动放下他已经拿到的筷子的。只有当他吃完饭之后，他才能放下他之前拿到的筷子，让别人拿。而一个人必须要有两根筷子才能吃饭。（持有并等待条件）
3. 一个人不能把别人已经拿到的筷子抢过来给自己用。（非抢占条件）
4. 这个桌子是圆桌，在每个哲学家的左手边和右手边各放一根筷子，且一个人只能拿这离他最近的两个筷子，不能拿别的。（循环等待条件）

现在存在这样一种情况：这三个人都先把他们左手边的筷子拿了，都在等右手边的筷子，除非两根筷子都拿到了，否则他们是不会放下已经拿到的筷子的，于是他们就在这里一直等了。现在我们要给他们改一下规矩，他们应该怎么做才能保证所有人都能吃上饭。

- 消除互斥条件：
  - 把一根筷子折成两根（磁盘共享）。
  - 或者请一个新人来，当某人想吃饭的时候，必须请示这个新人，让新人给他一次发两根筷子（打印机共享）。
- 消除持有并等待条件：
  - 每个人在想吃饭的时候，必须一次性把两根筷子都拿了。（一次性请求所有资源）
  - 或者当某个人拿不到另一根筷子的时候，要主动把他已经拿到的筷子给放下。（释放没有使用完的资源，可能前功尽弃）
- 消除非抢占条件：
  - 当某人想吃饭但是拿不到筷子的时候，可以把别人的筷子抢过来（CPU 调度、内存管理）。
- 消除循环等待条件：
  - 给这三个筷子编上 1、2、3 号，当某个人拿筷子的时候，必须先拿编号较小的。如 1-A-2-B-3-C-1，这里 A 把 1 拿了，B 把 2 拿了，C 必须先拿 1，拿不了就等，在等的时间里 B 可以把 3 拿了，然后释放 2 和 3，然后 A 拿 2、释放 1 和 2，C 再拿 1 和 3
  - 或者让奇数号的哲学家必须先拿他左边，后拿他右边的，而偶数号哲学家则与之相反。如 1-A-2-B-3-C-1，这里 A 把 1 拿了，B 必须先拿 3 拿不了 2，于是 2 可以被 A 拿，然后 A 释放 1 和 2
- 动态避免或检测修复：时间成本和程序复杂性高
- 不予理睬：让这三个人从头来一遍（终止线程、重启）

参考书：《操作系统之哲学原理》第 9 章
